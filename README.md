# ScoliDetect_v2 ‚Äî –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ —É–≥–ª–∞ –ö–æ–±–±–∞ –Ω–∞ —Ä–µ–Ω—Ç–≥–µ–Ω–æ–≥—Ä–∞–º–º–∞—Ö –ø–æ–∑–≤–æ–Ω–æ—á–Ω–∏–∫–∞

**ScoliDetect_v2** ‚Äî —ç—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π –ø—Ä–æ–µ–∫—Ç –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–≥–æ –∑—Ä–µ–Ω–∏—è,  
–≤ –∫–æ—Ç–æ—Ä–æ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω **–ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–Ω—Ç–≥–µ–Ω–æ–≤—Å–∫–∏—Ö —Å–Ω–∏–º–∫–æ–≤ –ø–æ–∑–≤–æ–Ω–æ—á–Ω–∏–∫–∞**  
–¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É–≥–ª–∞ –ö–æ–±–±–∞ –∏ –æ—Ü–µ–Ω–∫–∏ –≤—ã—Ä–∞–∂–µ–Ω–Ω–æ—Å—Ç–∏ —Å–∫–æ–ª–∏–æ–∑–∞.

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ —É–≥–ª–∞ –ö–æ–±–±–∞ –Ω–∞ DICOM-—Å–Ω–∏–º–∫–∞—Ö (–ø–µ—Ä–µ–¥–Ω–µ–∑–∞–¥–Ω—è—è –ø—Ä–æ–µ–∫—Ü–∏—è).  
‚úÖ –í—ã–¥–µ–ª–µ–Ω–∏–µ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π –ª–∏–Ω–∏–∏ –ø–æ–∑–≤–æ–Ω–æ—á–Ω–∏–∫–∞ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º (DP).  
‚úÖ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —Ä—É—á–Ω–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–¥–µ–ª–∏.  
‚úÖ –û–±—É—á–µ–Ω–∏–µ ML-–∫–æ—Ä—Ä–µ–∫—Ç–æ—Ä–∞ (RidgeCV) –¥–ª—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.  
‚úÖ –≠–∫—Å–ø–æ—Ä—Ç —Ç–∞–±–ª–∏—Ü (`results.csv`, `results_corrected.csv`) –∏ –≥—Ä–∞—Ñ–∏–∫–∞ "–¥–æ / –ø–æ—Å–ª–µ".  
‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ñ–ª–∞–π–Ω ‚Äî –±–µ–∑ –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.  

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

üìÇ ScoliDetect_v2/
‚îÇ
‚îú‚îÄ‚îÄ auto_cobb.py # –±–∞–∑–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –∏–∑–º–µ—Ä–µ–Ω–∏—è —É–≥–ª–∞ –ö–æ–±–±–∞ (DP + —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ)
‚îú‚îÄ‚îÄ auto_cobb_ml.py # —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å ML-–º–æ–¥–µ–ª—å—é –¥–ª—è energy map
‚îú‚îÄ‚îÄ cli_ml.py # CLI-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–∞–∫–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ DICOM
‚îú‚îÄ‚îÄ select_for_labeling.py # –æ—Ç–±–æ—Ä —Å–Ω–∏–º–∫–æ–≤ –¥–ª—è —Ä—É—á–Ω–æ–π —Ä–∞–∑–º–µ—Ç–∫–∏
‚îú‚îÄ‚îÄ label_gui.py # –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è GUI-—Ä–∞–∑–º–µ—Ç–∫–∞ –≥—Ä–∞–Ω–∏—Ü –ø–æ–∑–≤–æ–Ω–æ—á–Ω–∏–∫–∞
‚îú‚îÄ‚îÄ train_and_apply_correction.py # –æ–±—É—á–µ–Ω–∏–µ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ ML-–∫–æ—Ä—Ä–µ–∫—Ç–æ—Ä–∞ —É–≥–ª–∞
‚îú‚îÄ‚îÄ train_border_ml.py # –æ–±—É—á–µ–Ω–∏–µ ML-–º–æ–¥–µ–ª–∏ –≥—Ä–∞–Ω–∏—Ü (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è auto_cobb_ml)
‚îÇ
‚îú‚îÄ‚îÄ tools/clean_check.py # —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ —á–∏—Å—Ç–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ run_full_cycle.bat # –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –≤—Å–µ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞
‚îÇ
‚îú‚îÄ‚îÄ data/ # –∏—Å—Ö–æ–¥–Ω—ã–µ DICOM-—Ñ–∞–π–ª—ã (–Ω–µ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è)
‚îú‚îÄ‚îÄ to_label/ # —Å–Ω–∏–º–∫–∏, –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –¥–ª—è —Ä—É—á–Ω–æ–π —Ä–∞–∑–º–µ—Ç–∫–∏
‚îú‚îÄ‚îÄ reports_ml/ # –≥—Ä–∞—Ñ–∏–∫–∏ –∏ –æ—Ç—á—ë—Ç—ã –æ–±—É—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–æ—Ä–∞
‚îú‚îÄ‚îÄ results.csv # —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–≤—Ç–æ–∏–∑–º–µ—Ä–µ–Ω–∏–π
‚îú‚îÄ‚îÄ results_corrected.csv # —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—Å–ª–µ ML-–∫–æ—Ä—Ä–µ–∫—Ü–∏–∏
‚îî‚îÄ‚îÄ labels.csv # —Ç–∞–±–ª–∏—Ü–∞ —Ä—É—á–Ω—ã—Ö –º–µ—Ç–æ–∫ (true_angle_deg)


---

## üî¨ –≠—Ç–∞–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ (Pipeline)

| –®–∞–≥ | –û–ø–∏—Å–∞–Ω–∏–µ | –°–∫—Ä–∏–ø—Ç |
|-----|-----------|--------|
| **1Ô∏è‚É£ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç —É–≥–ª–æ–≤** | –ü—Ä–æ–≥–æ–Ω –≤—Å–µ—Ö DICOM —á–µ—Ä–µ–∑ `auto_cobb` –∏–ª–∏ `auto_cobb_ml` | `cli_ml.py` |
| **2Ô∏è‚É£ –û—Ç–±–æ—Ä —Å–Ω–∏–º–∫–æ–≤ –¥–ª—è —Ä–∞–∑–º–µ—Ç–∫–∏** | –í—ã–±–æ—Ä –Ω–∞–∏–±–æ–ª–µ–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ | `select_for_labeling.py` |
| **3Ô∏è‚É£ –†—É—á–Ω–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞** | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏—Å—Ç–∏–Ω–Ω–æ–≥–æ —É–≥–ª–∞ –≤—Ä–∞—á–æ–º / –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º | `label_gui.py` |
| **4Ô∏è‚É£ –û–±—É—á–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–æ—Ä–∞** | ML-–º–æ–¥–µ–ª—å –æ–±—É—á–∞–µ—Ç—Å—è –ø–æ —Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º | `train_and_apply_correction.py` |
| **5Ô∏è‚É£ –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è** | –°—Ç—Ä–æ–∏—Ç—Å—è –≥—Ä–∞—Ñ–∏–∫ "–¥–æ / –ø–æ—Å–ª–µ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏" | `reports_ml/before_after.png` |

---

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
python -m venv .venv
.venv\\Scripts\\activate
pip install -r requirements.txt

###  2Ô∏è‚É£ –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞

run_full_cycle.bat

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä–∏–ø—Ç –≤—ã–±–µ—Ä–µ—Ç 6 —Å–Ω–∏–º–∫–æ–≤ –¥–ª—è —Ä—É—á–Ω–æ–π —Ä–∞–∑–º–µ—Ç–∫–∏.
–ú–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å —á–∏—Å–ª–æ –≤—Ä—É—á–Ω—É—é:
run_full_cycle.bat 8

 ### 3Ô∏è‚É£ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

Python 3.10+, Windows 10/11,
—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è GPU-–≤–∞—Ä–∏–∞–Ω—Ç OpenCV (cv2).

requirements.txt

pydicom>=2.4.0
numpy>=1.22
opencv-python>=4.8.0.76
matplotlib>=3.7
scikit-image>=0.22
scikit-learn>=1.3
scipy>=1.10
typer>=0.12
rich>=13.7
pillow>=10.0
joblib>=1.3

### ‚úÖ –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

[INFO] –°–æ–≤–ø–∞–≤—à–∏—Ö —Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤: 18
[INFO] –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∏: ['angle_deg']
[INFO] —Ä–∞–∑–º–µ—Ä –æ–±—É—á–∞—é—â–µ–π –≤—ã–±–æ—Ä–∫–∏: 18, cv=5
[INFO] best alpha: 1.0000
[INFO] train MAE: 4.00¬∞ –Ω–∞ n=18
[OK] saved model: cobb_correction.pkl
[OK] —Å–æ—Ö—Ä–∞–Ω—ë–Ω —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π CSV: results_corrected.csv
[OK] –≥—Ä–∞—Ñ–∏–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω: reports_ml/before_after.png

### 4Ô∏è‚É£ –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã –∞–ª–≥–æ—Ä–∏—Ç–º–∞
1. –ò–∑ DICOM –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è –≤ –¥–∏–∞–ø–∞–∑–æ–Ω [0,1].
2. –ò–∑ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ ROI –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∫–∞—Ä—Ç–∞ –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤ (‚àáI).
3. –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ (DP) –¥–ª—è –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–æ–π —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏.
4. –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è —Ü–µ–Ω—Ç—Ä–ª–∞–π–Ω–∞ –∏ —É–≥–ª—ã –≤–µ—Ä—Ö–Ω–µ–≥–æ/–Ω–∏–∂–Ω–µ–≥–æ –Ω–∞–∫–ª–æ–Ω–æ–≤.
5.–†–∞–∑–Ω–æ—Å—Ç—å —É–≥–ª–æ–≤ –¥–∞—ë—Ç —É–≥–æ–ª –ö–æ–±–±–∞.
6.–ü–æ—Å–ª–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ç–∫–∏ –æ–±—É—á–∞–µ—Ç—Å—è Ridge-–º–æ–¥–µ–ª—å, –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É—é—â–∞—è bias.

### 5Ô∏è‚É£ –ü—Ä–∏–º–µ—Ä –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
 –í –æ—Ç—á—ë—Ç–µ reports_ml/before_after.png —Å—Ç—Ä–æ–∏—Ç—Å—è —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã—Ö –∏ –∏—Å—Ç–∏–Ω–Ω—ã—Ö —É–≥–ª–æ–≤:
‚úÖ –ì–æ–ª—É–±—ã–µ —Ç–æ—á–∫–∏ ‚Äî –¥–æ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏
‚úÖ –û—Ä–∞–Ω–∂–µ–≤—ã–µ ‚Äî –ø–æ—Å–ª–µ
‚úÖ –î–∏–∞–≥–æ–Ω–∞–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ

### ‚úÖ‚úÖ‚úÖ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –ª–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è —É—á–µ–±–Ω—ã—Ö –∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ü–µ–ª–µ–π.
–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∞–≤—Ç–æ—Ä—Å—Ç–≤–∞.
